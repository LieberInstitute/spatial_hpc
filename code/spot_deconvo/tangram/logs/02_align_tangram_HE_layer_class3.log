Adding LIBD modules
Loading git
Loading LIBD module for git-status-size/github
Loading LIBD module for git-lfs/2.8.0
Loading LIBD module for rmate/1.5.9
Loading LIBD module for ruby/2.6.4p104
Loading conda_R/4.1.x
**** Job starts ****
Thu Sep 14 16:17:19 EDT 2023
**** JHPCE info ****
User: mtippani
Job id: 3721569
Job name: align_tangram_HE
Hostname: compute-126.cm.cluster
Task id: 3
Loading LIBD module for tangram/1.0.2
INFO:root:Allocate tensors for mapping.
INFO:root:Begin training with 422 genes and customized density_prior in constrained mode...
Adding LIBD modules
Loading git
Loading LIBD module for git-status-size/github
Loading LIBD module for git-lfs/2.8.0
Loading LIBD module for rmate/1.5.9
Loading LIBD module for ruby/2.6.4p104
Loading conda_R/4.1.x
**** Job starts ****
Thu Sep 14 17:20:21 EDT 2023
**** JHPCE info ****
User: mtippani
Job id: 3721591
Job name: align_tangram_HE
Hostname: compute-126.cm.cluster
Task id: 3
Loading LIBD module for tangram/1.0.2
INFO:root:Allocate tensors for mapping.
INFO:root:Begin training with 422 genes and customized density_prior in constrained mode...
INFO:root:Saving results..
INFO:root:spatial prediction dataframe is saved in `obsm` `tangram_ct_pred` of the spatial AnnData.
Using tangram version: 1.0.2
Only using spatial sample V11A20-297_C1.
Re-aligning in "deconvolution mode"...
Score: 0.144, KL reg: 0.573, Count reg: 11859.477, Lambda f reg: 14455.844
Score: 0.583, KL reg: 0.031, Count reg: 3.850, Lambda f reg: 2224.914
Score: 0.607, KL reg: 0.024, Count reg: 3.281, Lambda f reg: 632.275
Score: 0.611, KL reg: 0.024, Count reg: 0.711, Lambda f reg: 401.330
Score: 0.612, KL reg: 0.024, Count reg: 0.881, Lambda f reg: 325.642
Score: 0.613, KL reg: 0.024, Count reg: 0.367, Lambda f reg: 282.873
Score: 0.614, KL reg: 0.024, Count reg: 0.762, Lambda f reg: 254.255
Score: 0.614, KL reg: 0.024, Count reg: 1.842, Lambda f reg: 238.259
Score: 0.615, KL reg: 0.024, Count reg: 1.535, Lambda f reg: 219.473
Score: 0.615, KL reg: 0.024, Count reg: 1.664, Lambda f reg: 201.177
Projecting annotation and plotting AUC...
Saving AnnDatas...
Done all tasks.
**** Job ends ****
Thu Sep 14 18:07:30 EDT 2023
Adding LIBD modules
Loading git
Loading LIBD module for git-status-size/github
Loading LIBD module for git-lfs/2.8.0
Loading LIBD module for rmate/1.5.9
Loading LIBD module for ruby/2.6.4p104
Loading conda_R/4.1.x
**** Job starts ****
Fri Sep 15 23:16:25 EDT 2023
**** JHPCE info ****
User: mtippani
Job id: 3722441
Job name: align_tangram_HE
Hostname: compute-126.cm.cluster
Task id: 3
Loading LIBD module for tangram/1.0.2
INFO:root:Allocate tensors for mapping.
INFO:root:Begin training with 422 genes and customized density_prior in constrained mode...
INFO:root:Saving results..
INFO:root:spatial prediction dataframe is saved in `obsm` `tangram_ct_pred` of the spatial AnnData.
Using tangram version: 1.0.2
Only using spatial sample V11A20-297_C1.
Re-aligning in "deconvolution mode"...
Score: 0.144, KL reg: 0.573, Count reg: 11530.344, Lambda f reg: 14261.152
Score: 0.582, KL reg: 0.031, Count reg: 4.078, Lambda f reg: 2192.761
Score: 0.606, KL reg: 0.024, Count reg: 2.559, Lambda f reg: 606.353
Score: 0.609, KL reg: 0.024, Count reg: 0.941, Lambda f reg: 380.726
Score: 0.611, KL reg: 0.024, Count reg: 0.492, Lambda f reg: 310.074
Score: 0.612, KL reg: 0.024, Count reg: 1.416, Lambda f reg: 271.725
Score: 0.612, KL reg: 0.024, Count reg: 2.008, Lambda f reg: 246.042
Score: 0.613, KL reg: 0.024, Count reg: 1.361, Lambda f reg: 227.507
Score: 0.613, KL reg: 0.024, Count reg: 0.980, Lambda f reg: 210.210
Score: 0.613, KL reg: 0.024, Count reg: 1.234, Lambda f reg: 196.504
Projecting annotation and plotting AUC...
Saving AnnDatas...
Done all tasks.
**** Job ends ****
Fri Sep 15 23:57:13 EDT 2023
Adding LIBD modules
Loading git
Loading LIBD module for git-status-size/github
Loading LIBD module for git-lfs/2.8.0
Loading LIBD module for rmate/1.5.9
Loading LIBD module for ruby/2.6.4p104
Loading conda_R/4.1.x
**** Job starts ****
Mon Oct  2 14:36:18 EDT 2023
**** JHPCE info ****
User: mtippani
Job id: 3749012
Job name: align_tangram_HE
Hostname: compute-126.cm.cluster
Task id: 3
Loading LIBD module for tangram/1.0.2
Using tangram version: 1.0.2
Only using spatial sample V11A20-297_C1.
Traceback (most recent call last):
  File "02_align_HE.py", line 72, in <module>
    ad_sp = sc.read_h5ad(str(sp_path_in).format(sample_name))
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/anndata/_io/h5ad.py", line 224, in read_h5ad
    with h5py.File(filename, "r") as f:
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/h5py/_hl/files.py", line 533, in __init__
    fid = make_fid(name, mode, userblock_size, fapl, fcpl, swmr=swmr)
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/h5py/_hl/files.py", line 226, in make_fid
    fid = h5f.open(name, flags, fapl=fapl)
  File "h5py/_objects.pyx", line 54, in h5py._objects.with_phil.wrapper
  File "h5py/_objects.pyx", line 55, in h5py._objects.with_phil.wrapper
  File "h5py/h5f.pyx", line 106, in h5py.h5f.open
FileNotFoundError: [Errno 2] Unable to open file (unable to open file: name = '/dcs04/lieber/lcolladotor/spatialHPC_LIBD4035/spatial_hpc/code/spot_deconvo/tangram/../../../processed-data/spot_deconvo/tangram/IF/2ndRun_newClass/layer/V11A20-297_C1/ad_sp_orig.h5ad', errno = 2, error message = 'No such file or directory', flags = 0, o_flags = 0)
**** Job ends ****
Mon Oct  2 14:36:23 EDT 2023
Adding LIBD modules
Loading git
Loading LIBD module for git-status-size/github
Loading LIBD module for git-lfs/2.8.0
Loading LIBD module for rmate/1.5.9
Loading LIBD module for ruby/2.6.4p104
Loading conda_R/4.1.x
**** Job starts ****
Mon Oct  2 15:12:28 EDT 2023
**** JHPCE info ****
User: mtippani
Job id: 3749031
Job name: align_tangram_HE
Hostname: compute-126.cm.cluster
Task id: 3
Loading LIBD module for tangram/1.0.2
Using tangram version: 1.0.2
Only using spatial sample V12D07-332_C1.
Re-aligning in "deconvolution mode"...
Traceback (most recent call last):
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3080, in get_loc
    return self._engine.get_loc(casted_key)
  File "pandas/_libs/index.pyx", line 70, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 101, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 4554, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 4562, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'count'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "02_align_HE.py", line 87, in <module>
    target_count = ad_sp.obs[cell_count_var].sum(),
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/pandas/core/frame.py", line 3024, in __getitem__
    indexer = self.columns.get_loc(key)
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3082, in get_loc
    raise KeyError(key) from err
KeyError: 'count'
**** Job ends ****
Mon Oct  2 15:12:40 EDT 2023
