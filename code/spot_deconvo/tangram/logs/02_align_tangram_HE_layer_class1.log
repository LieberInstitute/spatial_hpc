Adding LIBD modules
Loading git
Loading LIBD module for git-status-size/github
Loading LIBD module for git-lfs/2.8.0
Loading LIBD module for rmate/1.5.9
Loading LIBD module for ruby/2.6.4p104
Loading conda_R/4.1.x
**** Job starts ****
Thu Sep 14 15:59:56 EDT 2023
**** JHPCE info ****
User: mtippani
Job id: 3721569
Job name: align_tangram_HE
Hostname: compute-126.cm.cluster
Task id: 1
Loading LIBD module for tangram/1.0.2
INFO:root:Allocate tensors for mapping.
INFO:root:Begin training with 458 genes and customized density_prior in constrained mode...
Using tangram version: 1.0.2
Only using spatial sample V11A20-297_A1.
Re-aligning in "deconvolution mode"...
Traceback (most recent call last):
  File "02_align_HE.py", line 79, in <module>
    ad_map = tg.map_cells_to_space(
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/tangram/mapping_utils.py", line 337, in map_cells_to_space
    mapper = mo.MapperConstrained(
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/tangram/mapping_optimizer.py", line 240, in __init__
    self.S = torch.tensor(S, device=device, dtype=torch.float32)
RuntimeError: CUDA out of memory. Tried to allocate 124.00 MiB (GPU 0; 79.10 GiB total capacity; 0 bytes already allocated; 78.28 GiB free; 0 bytes reserved in total by PyTorch)
**** Job ends ****
Thu Sep 14 16:17:01 EDT 2023
Adding LIBD modules
Loading git
Loading LIBD module for git-status-size/github
Loading LIBD module for git-lfs/2.8.0
Loading LIBD module for rmate/1.5.9
Loading LIBD module for ruby/2.6.4p104
Loading conda_R/4.1.x
**** Job starts ****
Thu Sep 14 16:23:36 EDT 2023
**** JHPCE info ****
User: mtippani
Job id: 3721591
Job name: align_tangram_HE
Hostname: compute-126.cm.cluster
Task id: 1
Loading LIBD module for tangram/1.0.2
INFO:root:Allocate tensors for mapping.
INFO:root:Begin training with 458 genes and customized density_prior in constrained mode...
INFO:root:Saving results..
INFO:root:spatial prediction dataframe is saved in `obsm` `tangram_ct_pred` of the spatial AnnData.
Using tangram version: 1.0.2
Only using spatial sample V11A20-297_A1.
Re-aligning in "deconvolution mode"...
Score: 0.156, KL reg: 0.471, Count reg: 18974.617, Lambda f reg: 14444.993
Score: 0.611, KL reg: 0.022, Count reg: 21.464, Lambda f reg: 2411.695
Score: 0.632, KL reg: 0.015, Count reg: 4.521, Lambda f reg: 833.589
Score: 0.636, KL reg: 0.015, Count reg: 0.131, Lambda f reg: 589.969
Score: 0.637, KL reg: 0.015, Count reg: 0.375, Lambda f reg: 482.877
Score: 0.638, KL reg: 0.015, Count reg: 2.209, Lambda f reg: 414.909
Score: 0.639, KL reg: 0.015, Count reg: 3.527, Lambda f reg: 373.415
Score: 0.639, KL reg: 0.015, Count reg: 3.719, Lambda f reg: 340.672
Score: 0.640, KL reg: 0.015, Count reg: 0.865, Lambda f reg: 311.702
Score: 0.640, KL reg: 0.015, Count reg: 3.628, Lambda f reg: 279.815
Projecting annotation and plotting AUC...
Saving AnnDatas...
Done all tasks.
**** Job ends ****
Thu Sep 14 17:19:56 EDT 2023
Adding LIBD modules
Loading git
Loading LIBD module for git-status-size/github
Loading LIBD module for git-lfs/2.8.0
Loading LIBD module for rmate/1.5.9
Loading LIBD module for ruby/2.6.4p104
Loading conda_R/4.1.x
**** Job starts ****
Fri Sep 15 22:26:45 EDT 2023
**** JHPCE info ****
User: mtippani
Job id: 3722441
Job name: align_tangram_HE
Hostname: compute-126.cm.cluster
Task id: 1
Loading LIBD module for tangram/1.0.2
INFO:root:Allocate tensors for mapping.
INFO:root:Begin training with 458 genes and customized density_prior in constrained mode...
INFO:root:Saving results..
INFO:root:spatial prediction dataframe is saved in `obsm` `tangram_ct_pred` of the spatial AnnData.
Using tangram version: 1.0.2
Only using spatial sample V11A20-297_A1.
Re-aligning in "deconvolution mode"...
Score: 0.156, KL reg: 0.471, Count reg: 18607.773, Lambda f reg: 14257.524
Score: 0.609, KL reg: 0.023, Count reg: 32.189, Lambda f reg: 2344.686
Score: 0.631, KL reg: 0.016, Count reg: 6.016, Lambda f reg: 819.774
Score: 0.634, KL reg: 0.015, Count reg: 0.838, Lambda f reg: 577.336
Score: 0.636, KL reg: 0.015, Count reg: 0.716, Lambda f reg: 475.046
Score: 0.637, KL reg: 0.015, Count reg: 4.619, Lambda f reg: 413.327
Score: 0.637, KL reg: 0.015, Count reg: 2.588, Lambda f reg: 359.937
Score: 0.638, KL reg: 0.015, Count reg: 4.262, Lambda f reg: 326.987
Score: 0.638, KL reg: 0.015, Count reg: 0.308, Lambda f reg: 297.448
Score: 0.638, KL reg: 0.015, Count reg: 0.957, Lambda f reg: 273.309
Projecting annotation and plotting AUC...
Saving AnnDatas...
Done all tasks.
**** Job ends ****
Fri Sep 15 23:15:59 EDT 2023
Adding LIBD modules
Loading git
Loading LIBD module for git-status-size/github
Loading LIBD module for git-lfs/2.8.0
Loading LIBD module for rmate/1.5.9
Loading LIBD module for ruby/2.6.4p104
Loading conda_R/4.1.x
**** Job starts ****
Mon Oct  2 14:35:18 EDT 2023
**** JHPCE info ****
User: mtippani
Job id: 3749012
Job name: align_tangram_HE
Hostname: compute-126.cm.cluster
Task id: 1
Loading LIBD module for tangram/1.0.2
Using tangram version: 1.0.2
Only using spatial sample V11A20-297_A1.
Traceback (most recent call last):
  File "02_align_HE.py", line 72, in <module>
    ad_sp = sc.read_h5ad(str(sp_path_in).format(sample_name))
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/anndata/_io/h5ad.py", line 224, in read_h5ad
    with h5py.File(filename, "r") as f:
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/h5py/_hl/files.py", line 533, in __init__
    fid = make_fid(name, mode, userblock_size, fapl, fcpl, swmr=swmr)
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/h5py/_hl/files.py", line 226, in make_fid
    fid = h5f.open(name, flags, fapl=fapl)
  File "h5py/_objects.pyx", line 54, in h5py._objects.with_phil.wrapper
  File "h5py/_objects.pyx", line 55, in h5py._objects.with_phil.wrapper
  File "h5py/h5f.pyx", line 106, in h5py.h5f.open
FileNotFoundError: [Errno 2] Unable to open file (unable to open file: name = '/dcs04/lieber/lcolladotor/spatialHPC_LIBD4035/spatial_hpc/code/spot_deconvo/tangram/../../../processed-data/spot_deconvo/tangram/IF/2ndRun_newClass/layer/V11A20-297_A1/ad_sp_orig.h5ad', errno = 2, error message = 'No such file or directory', flags = 0, o_flags = 0)
**** Job ends ****
Mon Oct  2 14:35:27 EDT 2023
Adding LIBD modules
Loading git
Loading LIBD module for git-status-size/github
Loading LIBD module for git-lfs/2.8.0
Loading LIBD module for rmate/1.5.9
Loading LIBD module for ruby/2.6.4p104
Loading conda_R/4.1.x
**** Job starts ****
Mon Oct  2 15:09:28 EDT 2023
**** JHPCE info ****
User: mtippani
Job id: 3749031
Job name: align_tangram_HE
Hostname: compute-126.cm.cluster
Task id: 1
Loading LIBD module for tangram/1.0.2
Using tangram version: 1.0.2
Only using spatial sample V12D07-332_A1.
Re-aligning in "deconvolution mode"...
Traceback (most recent call last):
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3080, in get_loc
    return self._engine.get_loc(casted_key)
  File "pandas/_libs/index.pyx", line 70, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 101, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 4554, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 4562, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'count'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "02_align_HE.py", line 87, in <module>
    target_count = ad_sp.obs[cell_count_var].sum(),
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/pandas/core/frame.py", line 3024, in __getitem__
    indexer = self.columns.get_loc(key)
  File "/jhpce/shared/jhpce/libd/tangram/1.0.2/tangram_env/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3082, in get_loc
    raise KeyError(key) from err
KeyError: 'count'
**** Job ends ****
Mon Oct  2 15:10:36 EDT 2023
